{{partial "hw-tk/dbg-template" .}}{{/*
Hugo partial that renders individual feature blocks with header, text, and media within feature groups
*/}}
{{$h := slice "A feature is a block in a feature-group" }}
{{$h = $h | append (dict "a" "class " "h" "inner class of the block" "d" "message" "eg" "green messsage")}}
{{$h = $h | append (dict "a" "header" "h" "bold heading above media" "d" "nil" "eg" "Spring Sale")}}
{{$h = $h | append (dict "a" "text" "h" "body text above media" "d" "nil" "eg" "green messsage")}}
{{$h = $h | append (dict "a" "link" "h" "link when feature is clicked" "d" "nil" "eg" "green messsage")}}
{{/*
------------------------------------------------------------------------------------------------------------------------
*/}}
{{/* --- create a page object for the included page ---------------------- */}}
{{- $headerClass := .headerClass | default "header" -}}
{{- $featureClass := .class | default "message" -}}
{{- $srcClass := .srcClass | default "" -}}

{{/* features don't have captions, so remove .text and .header */}}
{{- $mediaDot := merge . (dict "srcClass" $srcClass "process" "fit 200x200" "header" false "text" false "page" .page) }}

{{ $link := .link}}
{{$u := urls.Parse $link}}
{{- if and $link (not $u.IsAbs) -}}
  {{if not (fileExists $u.Path)}}
    {{$err := printf "bad link(%s) for image" $link}}
    {{- partial "hw-tk/dbg" (dict "wrn" $err "kv" (dict "link" .link "resolved-link" $link "page" .page) ) -}}
  {{end}}
{{end}}
<div class="{{.class}}">
  {{- if $link -}}<a href="{{ $link }}">{{ end }}

    {{- with .header}}<h2 class="{{$headerClass}}">{{.}}</h2>{{- end -}}
    {{- with .text}}<p>{{.}}</p>{{- end -}}
    {{ partial "tool/media"  $mediaDot }}
    {{- with $link -}}</a>{{- end -}}

</div>