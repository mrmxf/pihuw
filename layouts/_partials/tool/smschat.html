{{partial "tmpl/dbg-template-comment" .}}{{/* Hugo partial that creates animated SMS chat conversations in iPhone-style interface */}}
{{- $page := .page -}}
{{- $header := .header -}}
{{- $from := .from -}}
{{- $alt := .alt -}}
{{- $chat := $page.Params.smschat.chat -}}
{{- $delay := $page.Params.smschat.delay -}}

<style>
.smschat-container {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.smschat-phone {
  width: 320px;
  height: 640px;
  background: #000;
  border-radius: 35px;
  padding: 8px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.3);
  position: relative;
}

.smschat-screen {
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 27px;
  position: relative;
  overflow: hidden;
}

.smschat-notch {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 150px;
  height: 30px;
  background: #000;
  border-radius: 0 0 15px 15px;
  z-index: 10;
}

.smschat-status-bar {
  height: 44px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
  color: white;
  font-size: 14px;
  font-weight: 600;
  position: relative;
  z-index: 5;
}

.smschat-header {
  height: 60px;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
  border-bottom: 1px solid rgba(0,0,0,0.1);
  position: relative;
}

.smschat-header h3 {
  margin: 0;
  font-size: 17px;
  font-weight: 600;
  color: #000;
}

.smschat-messages {
  flex: 1;
  padding: 20px 15px;
  overflow-y: auto;
  background: #fff;
  display: flex;
  flex-direction: column;
}

.smschat-message {
  max-width: 70%;
  margin-bottom: 8px;
  padding: 12px 16px;
  border-radius: 20px;
  font-size: 16px;
  line-height: 1.3;
  opacity: 0;
  transform: translateY(20px);
  animation: smschat-slideIn 0.3s ease forwards;
}

.smschat-message.smschat-from-me {
  background: #007AFF;
  color: white;
  align-self: flex-end;
  border-bottom-right-radius: 6px;
}

.smschat-message.smschat-from-other {
  background: #E9E9EB;
  color: #000;
  align-self: flex-start;
  border-bottom-left-radius: 6px;
}

.smschat-input-area {
  height: 50px;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(10px);
  border-top: 1px solid rgba(0,0,0,0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  color: #8E8E93;
  font-size: 16px;
}

.smschat-home-indicator {
  position: absolute;
  bottom: 8px;
  left: 50%;
  transform: translateX(-50%);
  width: 134px;
  height: 5px;
  background: rgba(255,255,255,0.3);
  border-radius: 3px;
}

@keyframes smschat-slideIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.smschat-typing {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  max-width: 70%;
  align-self: flex-start;
  background: #E9E9EB;
  border-radius: 20px;
  border-bottom-left-radius: 6px;
  margin-bottom: 8px;
}

.smschat-typing-dots {
  display: flex;
  gap: 4px;
}

.smschat-typing-dot {
  width: 8px;
  height: 8px;
  background: #8E8E93;
  border-radius: 50%;
  animation: smschat-typing 1.4s infinite;
}

.smschat-typing-dot:nth-child(2) {
  animation-delay: 0.2s;
}

.smschat-typing-dot:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes smschat-typing {
  0%, 60%, 100% {
    transform: translateY(0);
    opacity: 0.4;
  }
  30% {
    transform: translateY(-10px);
    opacity: 1;
  }
}
</style>

<div class="smschat-container">
  <div class="smschat-phone">
    <div class="smschat-screen">
      <div class="smschat-notch"></div>

      <div class="smschat-status-bar">
        <span>9:41</span>
        <span>●●●●●</span>
      </div>

      <div class="smschat-header">
        <h3>{{ $header }}</h3>
      </div>

      <div class="smschat-messages" id="smschat-messages">
      </div>

      <div class="smschat-input-area">
        iMessage
      </div>

      <div class="smschat-home-indicator"></div>
    </div>
  </div>
</div>

<script>
(function() {
  const messages = {{ $chat }};
  const delays = {{ $delay }};
  const fromName = {{ $from }};
  const altName = {{ $alt }};

  const messagesContainer = document.getElementById('smschat-messages');
  let messageIndex = 0;
  let isFromMe = false; // Start with alt person

  function createTypingIndicator() {
    const typingDiv = document.createElement('div');
    typingDiv.className = 'smschat-typing';
    typingDiv.innerHTML = `
      <div class="smschat-typing-dots">
        <div class="smschat-typing-dot"></div>
        <div class="smschat-typing-dot"></div>
        <div class="smschat-typing-dot"></div>
      </div>
    `;
    return typingDiv;
  }

  function addMessage(text, fromMe) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `smschat-message ${fromMe ? 'smschat-from-me' : 'smschat-from-other'}`;
    messageDiv.textContent = text;

    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;

    // Trigger animation
    setTimeout(() => {
      messageDiv.style.opacity = '1';
      messageDiv.style.transform = 'translateY(0)';
    }, 10);
  }

  function showNextMessage() {
    if (messageIndex >= messages.length) return;

    const currentDelay = delays[messageIndex] || 2;
    const message = messages[messageIndex];

    // Show typing indicator
    const typingIndicator = createTypingIndicator();
    if (!isFromMe) {
      messagesContainer.appendChild(typingIndicator);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    setTimeout(() => {
      // Remove typing indicator
      if (!isFromMe && typingIndicator.parentNode) {
        typingIndicator.remove();
      }

      // Add actual message
      addMessage(message, isFromMe);

      // Prepare for next message
      messageIndex++;
      isFromMe = !isFromMe;

      // Schedule next message
      setTimeout(showNextMessage, currentDelay * 1000);
    }, isFromMe ? 500 : 1500); // Shorter delay for "me", longer for typing effect
  }

  // Start the conversation after a brief delay
  setTimeout(showNextMessage, 1000);
})();
</script>